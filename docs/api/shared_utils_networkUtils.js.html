<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: shared/utils/networkUtils.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: shared/utils/networkUtils.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// Network utility functions for Vikings Event Management Mobile
import { Capacitor } from '@capacitor/core';
import { Network } from '@capacitor/network';
import { sentryUtils } from '../services/utils/sentry.js';
import logger, { LOG_CATEGORIES } from '../services/utils/logger.js';

/**
 * Check current network status across platforms with error handling
 * Works on both web browsers and native mobile platforms (iOS/Android)
 * 
 * @returns {Promise&lt;boolean>} True if network is available, false if offline
 * @throws {Error} If network status cannot be determined
 * 
 * @example
 * // Check network before making API calls
 * const isOnline = await checkNetworkStatus();
 * if (isOnline) {
 *   await fetchDataFromAPI();
 * } else {
 *   loadFromCache();
 * }
 */
export async function checkNetworkStatus() {
  try {
    if (Capacitor.isNativePlatform()) {
      // Native platform - use Capacitor Network plugin
      const status = await Network.getStatus();
      
      // Only log when network status changes (not every check)
      
      return status.connected;
    } else {
      // Web browser - use navigator.onLine
      const isOnline = navigator.onLine;
      
      // Only log network changes, not routine checks
      
      return isOnline;
    }
  } catch (error) {
    // Log network check failure
    logger.error('Failed to check network status', {
      platform: Capacitor.isNativePlatform() ? 'native' : 'web',
      error: error.message,
      stack: error.stack,
    }, LOG_CATEGORIES.ERROR);

    // Capture exception with Sentry
    sentryUtils.captureException(error, {
      tags: {
        operation: 'network_status_check',
        platform: Capacitor.isNativePlatform() ? 'native' : 'web',
      },
      contexts: {
        device: {
          platform: Capacitor.getPlatform(),
          isNative: Capacitor.isNativePlatform(),
        },
      },
    });

    // Rethrow to allow caller to handle
    throw new Error(`Network status check failed: ${error.message}`);
  }
}

/**
 * Get detailed network information with connection type and speed details
 * Provides enhanced network information for native platforms, basic info for web
 * 
 * @returns {Promise&lt;NetworkStatus>} Network status object with detailed information
 * @throws {Error} If network information cannot be retrieved
 * 
 * @typedef {Object} NetworkStatus
 * @property {boolean} connected - Whether device is connected to network
 * @property {string} connectionType - Type of connection ('wifi', 'cellular', 'ethernet', 'unknown')
 * @property {string} [ssid] - WiFi network name (native only, if available)
 * @property {string} [bssid] - WiFi network BSSID (native only, if available)
 * 
 * @example
 * // Get detailed network info for connection quality decisions
 * const networkInfo = await getDetailedNetworkStatus();
 * if (networkInfo.connected &amp;&amp; networkInfo.connectionType === 'wifi') {
 *   // High-quality connection - fetch full resolution images
 *   await loadHighResImages();
 * } else if (networkInfo.connected &amp;&amp; networkInfo.connectionType === 'cellular') {
 *   // Mobile connection - optimize for data usage
 *   await loadOptimizedContent();
 * }
 */
export async function getDetailedNetworkStatus() {
  try {
    if (Capacitor.isNativePlatform()) {
      // Native platform - get detailed network information
      const status = await Network.getStatus();
      
      // Network status retrieved - routine operation
      
      return status;
    } else {
      // Web browser - limited information available
      const networkInfo = {
        connected: navigator.onLine,
        connectionType: 'unknown',
      };
      
      // Try to get connection info if available (experimental)
      if (navigator.connection) {
        networkInfo.connectionType = navigator.connection.effectiveType || 'unknown';
        networkInfo.downlink = navigator.connection.downlink;
        networkInfo.effectiveType = navigator.connection.effectiveType;
      }
      
      // Network status retrieved - routine operation
      
      return networkInfo;
    }
  } catch (error) {
    logger.error('Failed to get detailed network status', {
      platform: Capacitor.isNativePlatform() ? 'native' : 'web',
      error: error.message,
      stack: error.stack,
    }, LOG_CATEGORIES.ERROR);

    sentryUtils.captureException(error, {
      tags: {
        operation: 'detailed_network_status',
        platform: Capacitor.isNativePlatform() ? 'native' : 'web',
      },
    });

    throw new Error(`Failed to get network details: ${error.message}`);
  }
}

/**
 * Add network status change listener with error handling
 * Sets up monitoring for network connectivity changes across platforms
 * 
 * @param {NetworkChangeCallback} callback - Function to call when network status changes
 * @returns {Function} Cleanup function to remove the listener
 * @throws {Error} If listener setup fails
 * 
 * @callback NetworkChangeCallback
 * @param {NetworkStatus} status - Network status object containing connection info
 * 
 * @example
 * // Monitor network changes and update UI
 * const removeListener = addNetworkListener((status) => {
 *   if (status.connected) {
 *     console.log('Back online!');
 *     syncPendingData();
 *   } else {
 *     console.log('Gone offline');
 *     showOfflineIndicator();
 *   }
 * });
 * 
 * // Later, clean up the listener
 * removeListener();
 */
export function addNetworkListener(callback) {
  if (typeof callback !== 'function') {
    const error = new Error('Network listener callback must be a function');
    
    logger.error('Invalid network listener callback', {
      providedType: typeof callback,
      isFunction: typeof callback === 'function',
    }, LOG_CATEGORIES.ERROR);
    
    sentryUtils.captureException(error, {
      tags: {
        operation: 'network_listener_setup',
        validation_error: true,
      },
    });
    
    throw error;
  }

  try {
    if (Capacitor.isNativePlatform()) {
      // Native platform - use Capacitor Network plugin
      // Setting up native network listener
      
      const listener = Network.addListener('networkStatusChange', (status) => {
        // Network status changed - callback will handle
        
        callback(status);
      });
      
      return () => {
        // Removing network listener
        listener.remove();
      };
    } else {
      // Web browser - use native browser events
      // Setting up web network listeners
      
      const onlineHandler = () => {
        const status = { connected: true, connectionType: 'unknown' };
        
        // Network came online - callback will handle
        callback(status);
      };
      
      const offlineHandler = () => {
        const status = { connected: false, connectionType: 'unknown' };
        
        // Network went offline - callback will handle
        callback(status);
      };
      
      window.addEventListener('online', onlineHandler);
      window.addEventListener('offline', offlineHandler);
      
      return () => {
        // Removing web network listeners
        window.removeEventListener('online', onlineHandler);
        window.removeEventListener('offline', offlineHandler);
      };
    }
  } catch (error) {
    logger.error('Failed to setup network listener', {
      platform: Capacitor.isNativePlatform() ? 'native' : 'web',
      error: error.message,
      stack: error.stack,
    }, LOG_CATEGORIES.ERROR);

    sentryUtils.captureException(error, {
      tags: {
        operation: 'network_listener_setup',
        platform: Capacitor.isNativePlatform() ? 'native' : 'web',
      },
    });

    throw new Error(`Failed to setup network listener: ${error.message}`);
  }
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-DatabaseService.html">DatabaseService</a></li><li><a href="module-EventCard.html">EventCard</a></li><li><a href="module-FlexiRecordService.html">FlexiRecordService</a></li><li><a href="module-ageUtils.html">ageUtils</a></li><li><a href="module-auth.html">auth</a></li><li><a href="module-cacheCleanup.html">cacheCleanup</a></li><li><a href="module-flexiRecordTransforms.html">flexiRecordTransforms</a></li><li><a href="module-logger.html">logger</a></li><li><a href="module-notifications.html">notifications</a></li><li><a href="module-sectionHelpers.html">sectionHelpers</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-logger-logger.html">logger</a></li></ul><h3>Classes</h3><ul><li><a href="APIQueue.html">APIQueue</a></li><li><a href="RateLimitQueue.html">RateLimitQueue</a></li><li><a href="module-DatabaseService-DatabaseService.html">DatabaseService</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Alert">Alert</a></li><li><a href="global.html#AuthButton">AuthButton</a></li><li><a href="global.html#CampGroupCard">CampGroupCard</a></li><li><a href="global.html#CampGroupsView">CampGroupsView</a></li><li><a href="global.html#ConfirmModal">ConfirmModal</a></li><li><a href="global.html#DEMO_CACHE_DATA">DEMO_CACHE_DATA</a></li><li><a href="global.html#GroupNamesEditModal">GroupNamesEditModal</a></li><li><a href="global.html#Modal">Modal</a></li><li><a href="global.html#REQUIRED_VIKING_SECTION_MOVERS_FIELDS">REQUIRED_VIKING_SECTION_MOVERS_FIELDS</a></li><li><a href="global.html#SectionFilter">SectionFilter</a></li><li><a href="global.html#_generateProductionFormatAttendance">_generateProductionFormatAttendance</a></li><li><a href="global.html#assignMemberToCampGroupDemo">assignMemberToCampGroupDemo</a></li><li><a href="global.html#batchAssignMembers">batchAssignMembers</a></li><li><a href="global.html#buildEventCard">buildEventCard</a></li><li><a href="global.html#checkNetworkStatus">checkNetworkStatus</a></li><li><a href="global.html#clearFlexiRecordCaches">clearFlexiRecordCaches</a></li><li><a href="global.html#cn">cn</a></li><li><a href="global.html#convertSharedEventToAttendanceFormat">convertSharedEventToAttendanceFormat</a></li><li><a href="global.html#demoConfig">demoConfig</a></li><li><a href="global.html#expandSharedEvents">expandSharedEvents</a></li><li><a href="global.html#extractFlexiRecordContext">extractFlexiRecordContext</a></li><li><a href="global.html#fetchAllSectionEvents">fetchAllSectionEvents</a></li><li><a href="global.html#fetchEventAttendance">fetchEventAttendance</a></li><li><a href="global.html#fetchMostRecentTermId">fetchMostRecentTermId</a></li><li><a href="global.html#fetchSectionEvents">fetchSectionEvents</a></li><li><a href="global.html#filterEventsByDateRange">filterEventsByDateRange</a></li><li><a href="global.html#formatPhoneForCall">formatPhoneForCall</a></li><li><a href="global.html#generateDemoSharedAttendance">generateDemoSharedAttendance</a></li><li><a href="global.html#generateVikingSectionMoversErrorMessages">generateVikingSectionMoversErrorMessages</a></li><li><a href="global.html#getEventAttendance">getEventAttendance</a></li><li><a href="global.html#getEventSharingStatus">getEventSharingStatus</a></li><li><a href="global.html#getEventSummary">getEventSummary</a></li><li><a href="global.html#getEvents">getEvents</a></li><li><a href="global.html#getFlexiRecords">getFlexiRecords</a></li><li><a href="global.html#getFlexiStructure">getFlexiStructure</a></li><li><a href="global.html#getListOfMembers">getListOfMembers</a></li><li><a href="global.html#getMembersGrid">getMembersGrid</a></li><li><a href="global.html#getMostRecentTermId">getMostRecentTermId</a></li><li><a href="global.html#getSharedEventAttendance">getSharedEventAttendance</a></li><li><a href="global.html#getSingleFlexiRecord">getSingleFlexiRecord</a></li><li><a href="global.html#getStartupData">getStartupData</a></li><li><a href="global.html#getTerms">getTerms</a></li><li><a href="global.html#getUserAccessibleSections">getUserAccessibleSections</a></li><li><a href="global.html#getUserRoles">getUserRoles</a></li><li><a href="global.html#groupContactInfo">groupContactInfo</a></li><li><a href="global.html#groupEventsByName">groupEventsByName</a></li><li><a href="global.html#handleAPIResponseWithRateLimit">handleAPIResponseWithRateLimit</a></li><li><a href="global.html#handlePhoneCall">handlePhoneCall</a></li><li><a href="global.html#initializeDemoMode">initializeDemoMode</a></li><li><a href="global.html#isDemoMode">isDemoMode</a></li><li><a href="global.html#isSharedEventOwner">isSharedEventOwner</a></li><li><a href="global.html#isValidPhoneNumber">isValidPhoneNumber</a></li><li><a href="global.html#logRateLimitInfo">logRateLimitInfo</a></li><li><a href="global.html#mergeSharedAndSectionAttendance">mergeSharedAndSectionAttendance</a></li><li><a href="global.html#multiUpdateFlexiRecord">multiUpdateFlexiRecord</a></li><li><a href="global.html#organizeByCampGroups">organizeByCampGroups</a></li><li><a href="global.html#parseTimestamp">parseTimestamp</a></li><li><a href="global.html#quickValidateVikingSectionMovers">quickValidateVikingSectionMovers</a></li><li><a href="global.html#retrieveUserInfo">retrieveUserInfo</a></li><li><a href="global.html#safeCacheWithLogging">safeCacheWithLogging</a></li><li><a href="global.html#safeGetItem">safeGetItem</a></li><li><a href="global.html#safeGetSessionItem">safeGetSessionItem</a></li><li><a href="global.html#safeSetItem">safeSetItem</a></li><li><a href="global.html#safeSetSessionItem">safeSetSessionItem</a></li><li><a href="global.html#sleep">sleep</a></li><li><a href="global.html#sleepWithAbort">sleepWithAbort</a></li><li><a href="global.html#testBackendConnection">testBackendConnection</a></li><li><a href="global.html#updateFlexiRecord">updateFlexiRecord</a></li><li><a href="global.html#useAttendanceData">useAttendanceData</a></li><li><a href="global.html#useSignInOut">useSignInOut</a></li><li><a href="global.html#validateMemberMove">validateMemberMove</a></li><li><a href="global.html#validateTokenBeforeAPICall">validateTokenBeforeAPICall</a></li><li><a href="global.html#validateVikingSectionMoversFlexiRecord">validateVikingSectionMoversFlexiRecord</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Thu Sep 11 2025 21:43:53 GMT+0100 (British Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
