<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: features/events/components/GroupNamesEditModal.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: features/events/components/GroupNamesEditModal.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useState, useEffect, useCallback } from 'react';
import { Alert } from '../../../shared/components/ui';
import logger, { LOG_CATEGORIES } from '../../../shared/services/utils/logger.js';

/**
 * Modal for editing camp group names
 * Allows bulk renaming of groups with validation and multi-section support
 *
 * @param {Object} props - Component props
 * @param {boolean} props.isOpen - Whether modal is open
 * @param {Function} props.onClose - Close modal callback
 * @param {Object} props.groups - Current groups object from organizedGroups.groups
 * @param {Function} props.onRename - Rename callback with (oldName, newName, membersBySection)
 * @param {Function} props.onDelete - Delete callback with (groupName, membersBySection)
 * @param {boolean} props.loading - Whether rename operation is in progress
 */
function GroupNamesEditModal({
  isOpen,
  onClose,
  groups = {},
  onRename,
  onDelete,
  loading = false,
}) {
  const [groupNames, setGroupNames] = useState({});
  const [errors, setErrors] = useState({});
  const [hasChanges, setHasChanges] = useState(false);

  // Initialize group names when modal opens or groups change
  useEffect(() => {
    if (isOpen &amp;&amp; groups) {
      const initialNames = {};
      Object.entries(groups).forEach(([groupName]) => {
        // Use group name without "Group " prefix for editing
        const displayName = groupName.replace(/^Group /, '');
        initialNames[groupName] = displayName;
      });
      setGroupNames(initialNames);
      setErrors({});
      setHasChanges(false);
    }
  }, [isOpen, groups]);

  // Validate group names for uniqueness and constraints
  const validateNames = useCallback((names) => {
    const newErrors = {};
    const usedNames = new Set();

    Object.entries(names).forEach(([originalGroupName, newName]) => {
      const trimmedName = newName.trim();
      const lowerName = trimmedName.toLowerCase();

      // Required field
      if (!trimmedName) {
        newErrors[originalGroupName] = 'Group name is required';
        return;
      }

      // Check for duplicates
      if (usedNames.has(lowerName)) {
        newErrors[originalGroupName] = 'Group name must be unique';
        return;
      }

      // Check for reserved names - only block "Unassigned" for non-unassigned groups
      if (
        lowerName === 'unassigned' &amp;&amp;
        originalGroupName !== 'Group Unassigned'
      ) {
        newErrors[originalGroupName] = '"Unassigned" is a reserved name';
        return;
      }

      // Character validation (basic)
      if (!/^[a-zA-Z0-9\s\-_]+$/.test(trimmedName)) {
        newErrors[originalGroupName] =
          'Only letters, numbers, spaces, hyphens and underscores allowed';
        return;
      }

      // Length validation
      if (trimmedName.length > 20) {
        newErrors[originalGroupName] =
          'Group name too long (max 20 characters)';
        return;
      }

      usedNames.add(lowerName);
    });

    return newErrors;
  }, []);

  // Handle name change
  const handleNameChange = useCallback(
    (originalGroupName, newValue) => {
      setGroupNames((prev) => {
        const updated = { ...prev, [originalGroupName]: newValue };

        // Check if there are changes from original
        const hasActualChanges = Object.entries(updated).some(
          ([groupName, newName]) => {
            const originalDisplayName = groupName.replace(/^Group /, '');
            return newName.trim() !== originalDisplayName;
          },
        );

        setHasChanges(hasActualChanges);

        // Validate on each change
        const validationErrors = validateNames(updated);
        setErrors(validationErrors);

        return updated;
      });
    },
    [validateNames],
  );

  // Handle save
  const handleSave = useCallback(async () => {
    if (loading) return;

    const validationErrors = validateNames(groupNames);
    if (Object.keys(validationErrors).length > 0) {
      setErrors(validationErrors);
      return;
    }

    // Process renames
    const renames = [];
    Object.entries(groupNames).forEach(([originalGroupName, newName]) => {
      const trimmedNewName = newName.trim();
      const originalDisplayName = originalGroupName.replace(/^Group /, '');

      if (trimmedNewName !== originalDisplayName) {
        const group = groups[originalGroupName];
        if (group) {
          // Organize members by section for multi-section API calls
          const membersBySection = {};

          [...(group.youngPeople || []), ...(group.leaders || [])].forEach(
            (member) => {
              const sectionId = member.sectionid;
              if (!membersBySection[sectionId]) {
                membersBySection[sectionId] = [];
              }
              membersBySection[sectionId].push(member);
            },
          );

          renames.push({
            oldName: originalGroupName,
            newName: trimmedNewName,
            membersBySection,
            group,
          });
        }
      }
    });

    if (renames.length === 0) {
      logger.info('No group names to rename', {}, LOG_CATEGORIES.APP);
      onClose();
      return;
    }

    logger.info(
      'Processing group renames',
      {
        renameCount: renames.length,
        totalGroups: Object.keys(groups).length,
      },
      LOG_CATEGORIES.APP,
    );

    // Execute renames through callback
    for (const rename of renames) {
      try {
        await onRename(rename.oldName, rename.newName, rename.membersBySection);
      } catch (error) {
        logger.error(
          'Failed to rename group',
          {
            oldName: rename.oldName,
            newName: rename.newName,
            error: error.message,
          },
          LOG_CATEGORIES.ERROR,
        );

        // Continue with other renames even if one fails
        continue;
      }
    }

    // Close modal after all renames are processed
    onClose();
  }, [groupNames, groups, onRename, onClose, loading, validateNames]);

  // Handle delete group
  const handleDeleteGroup = useCallback(
    async (groupName) => {
      if (loading || !onDelete) return;

      const group = groups[groupName];
      if (!group) return;

      // Organize members by section for multi-section API calls
      const membersBySection = {};

      [...(group.youngPeople || []), ...(group.leaders || [])].forEach(
        (member) => {
          const sectionId = member.sectionid;
          if (!membersBySection[sectionId]) {
            membersBySection[sectionId] = [];
          }
          membersBySection[sectionId].push(member);
        },
      );

      const memberCount = Object.values(membersBySection).reduce(
        (sum, members) => sum + members.length,
        0,
      );

      // Debug: Log exactly which members are being deleted
      logger.info(
        'Group delete preparation',
        {
          groupName,
          memberCount,
          membersToDelete: Object.fromEntries(
            Object.entries(membersBySection).map(([sectionId, members]) => [
              sectionId,
              members.map((m) => ({
                scoutid: m.scoutid,
                name: m.name || `${m.firstname} ${m.lastname}`,
              })),
            ]),
          ),
        },
        LOG_CATEGORIES.APP,
      );

      if (memberCount === 0) {
        logger.info(
          'No members to delete for empty group',
          { groupName },
          LOG_CATEGORIES.APP,
        );
        return;
      }

      // Confirm deletion
      const confirmed = window.confirm(
        `Delete "${groupName}" and move ${memberCount} member${memberCount !== 1 ? 's' : ''} to Unassigned?`,
      );

      if (!confirmed) return;

      try {
        await onDelete(groupName, membersBySection);
        onClose();
      } catch (error) {
        logger.error(
          'Failed to delete group',
          {
            groupName,
            error: error.message,
          },
          LOG_CATEGORIES.ERROR,
        );
      }
    },
    [groups, onDelete, loading, onClose],
  );

  // Handle cancel
  const handleCancel = useCallback(() => {
    if (loading) return;
    onClose();
  }, [onClose, loading]);

  if (!isOpen) return null;

  const groupEntries = Object.entries(groups).sort((a, b) => {
    // Sort: numbered groups first, then unassigned last
    const [nameA] = a;
    const [nameB] = b;

    if (nameA === 'Group Unassigned') return 1;
    if (nameB === 'Group Unassigned') return -1;

    const numA = parseInt(nameA.replace('Group ', '')) || 0;
    const numB = parseInt(nameB.replace('Group ', '')) || 0;
    return numA - numB;
  });

  return (
    &lt;div
      className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
      data-oid="ksa0d1_"
    >
      &lt;div
        className="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden"
        data-oid="_xzti1v"
      >
        {/* Header */}
        &lt;div className="px-6 py-4 border-b border-gray-200" data-oid="w:j50.b">
          &lt;h2
            className="text-xl font-semibold text-gray-900"
            data-oid="b0x9x7h"
          >
            Edit Group Names
          &lt;/h2>
          &lt;p className="text-sm text-gray-600 mt-1" data-oid="18iiy_7">
            Rename camp groups - all members in each group will be updated
          &lt;/p>
        &lt;/div>

        {/* Content */}
        &lt;div
          className="px-6 py-4 overflow-y-auto max-h-[60vh]"
          data-oid="fbpcw7a"
        >
          {Object.keys(errors).length > 0 &amp;&amp; (
            &lt;Alert variant="error" className="mb-4" data-oid="9i3l0tz">
              &lt;Alert.Title data-oid="4qhsz54">Validation Errors&lt;/Alert.Title>
              &lt;Alert.Description data-oid="e4spk6t">
                Please fix the errors below before saving.
              &lt;/Alert.Description>
            &lt;/Alert>
          )}

          &lt;div className="space-y-4" data-oid="stc4uf5">
            {groupEntries.map(([originalGroupName, group]) => {
              const memberCount =
                (group.youngPeople?.length || 0) + (group.leaders?.length || 0);
              const currentValue = groupNames[originalGroupName] || '';
              const hasError = errors[originalGroupName];

              return (
                &lt;div
                  key={originalGroupName}
                  className="flex items-center space-x-4 p-4 border rounded-lg"
                  data-oid="ilsgv4g"
                >
                  &lt;div
                    className="flex-shrink-0 w-20 text-sm text-gray-600"
                    data-oid="nszj1qy"
                  >
                    {memberCount} member{memberCount !== 1 ? 's' : ''}
                  &lt;/div>

                  &lt;div className="flex-1" data-oid="-ed6jek">
                    &lt;input
                      id={`group-${originalGroupName}`}
                      type="text"
                      value={currentValue}
                      onChange={(e) =>
                        handleNameChange(originalGroupName, e.target.value)
                      }
                      placeholder="Enter new group name"
                      className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-scout-blue ${
                        hasError ? 'border-red-500 focus:border-red-500 focus:ring-red-200' : 'border-gray-300'
                      }`}
                      disabled={loading}
                      data-oid="vy.2us4"
                    />

                    {hasError &amp;&amp; (
                      &lt;p
                        className="text-red-500 text-xs mt-1"
                        data-oid="zmfjdao"
                      >
                        {hasError}
                      &lt;/p>
                    )}
                  &lt;/div>

                  {/* Delete button - don't show for Unassigned group */}
                  {originalGroupName !== 'Group Unassigned' &amp;&amp;
                    memberCount > 0 &amp;&amp; (
                    &lt;button
                      onClick={() => handleDeleteGroup(originalGroupName)}
                      disabled={loading}
                      className="px-3 py-1.5 text-sm border border-scout-red-light text-scout-red hover:text-scout-red-dark hover:bg-scout-red-light hover:bg-opacity-10 disabled:opacity-50 disabled:cursor-not-allowed rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-scout-red-light focus:ring-opacity-50"
                      type="button"
                      title={`Delete ${originalGroupName} (move ${memberCount} member${memberCount !== 1 ? 's' : ''} to Unassigned)`}
                      data-oid=":t.ilsz"
                    >
                        Delete
                    &lt;/button>
                  )}
                &lt;/div>
              );
            })}
          &lt;/div>

          {groupEntries.length === 0 &amp;&amp; (
            &lt;div className="text-center py-8 text-gray-500" data-oid="wrs_muw">
              No groups available to rename
            &lt;/div>
          )}
        &lt;/div>

        {/* Footer */}
        &lt;div
          className="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3"
          data-oid="5st6.ue"
        >
          &lt;button
            onClick={handleCancel}
            disabled={loading}
            className="px-4 py-2 border border-gray-300 text-gray-700 hover:text-gray-900 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-scout-blue focus:ring-opacity-50"
            type="button"
            data-oid="qsz0ya4"
          >
            Cancel
          &lt;/button>
          &lt;button
            onClick={handleSave}
            disabled={loading || Object.keys(errors).length > 0 || !hasChanges}
            className="px-4 py-2 bg-scout-blue text-white hover:bg-scout-blue-dark disabled:opacity-50 disabled:cursor-not-allowed rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-scout-blue-light focus:ring-opacity-50"
            type="button"
            data-oid="a9cq49p"
          >
            {loading ? 'Saving...' : 'Save Changes'}
          &lt;/button>
        &lt;/div>
      &lt;/div>
    &lt;/div>
  );
}

export default GroupNamesEditModal;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-DatabaseService.html">DatabaseService</a></li><li><a href="module-EventCard.html">EventCard</a></li><li><a href="module-FlexiRecordService.html">FlexiRecordService</a></li><li><a href="module-ageUtils.html">ageUtils</a></li><li><a href="module-auth.html">auth</a></li><li><a href="module-cacheCleanup.html">cacheCleanup</a></li><li><a href="module-flexiRecordTransforms.html">flexiRecordTransforms</a></li><li><a href="module-logger.html">logger</a></li><li><a href="module-notifications.html">notifications</a></li><li><a href="module-sectionHelpers.html">sectionHelpers</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-logger-logger.html">logger</a></li></ul><h3>Classes</h3><ul><li><a href="APIQueue.html">APIQueue</a></li><li><a href="ErrorBoundary.html">ErrorBoundary</a></li><li><a href="RateLimitQueue.html">RateLimitQueue</a></li><li><a href="SyncService.html">SyncService</a></li><li><a href="module-DatabaseService-DatabaseService.html">DatabaseService</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Alert">Alert</a></li><li><a href="global.html#AuthButton">AuthButton</a></li><li><a href="global.html#CampGroupCard">CampGroupCard</a></li><li><a href="global.html#CampGroupsView">CampGroupsView</a></li><li><a href="global.html#ConfirmModal">ConfirmModal</a></li><li><a href="global.html#DEMO_CACHE_DATA">DEMO_CACHE_DATA</a></li><li><a href="global.html#GroupNamesEditModal">GroupNamesEditModal</a></li><li><a href="global.html#Modal">Modal</a></li><li><a href="global.html#REQUIRED_VIKING_SECTION_MOVERS_FIELDS">REQUIRED_VIKING_SECTION_MOVERS_FIELDS</a></li><li><a href="global.html#SectionFilter">SectionFilter</a></li><li><a href="global.html#_generateProductionFormatAttendance">_generateProductionFormatAttendance</a></li><li><a href="global.html#assignMemberToCampGroupDemo">assignMemberToCampGroupDemo</a></li><li><a href="global.html#batchAssignMembers">batchAssignMembers</a></li><li><a href="global.html#buildEventCard">buildEventCard</a></li><li><a href="global.html#checkNetworkStatus">checkNetworkStatus</a></li><li><a href="global.html#clearFlexiRecordCaches">clearFlexiRecordCaches</a></li><li><a href="global.html#cn">cn</a></li><li><a href="global.html#convertSharedEventToAttendanceFormat">convertSharedEventToAttendanceFormat</a></li><li><a href="global.html#demoConfig">demoConfig</a></li><li><a href="global.html#expandSharedEvents">expandSharedEvents</a></li><li><a href="global.html#extractFlexiRecordContext">extractFlexiRecordContext</a></li><li><a href="global.html#fetchAllSectionEvents">fetchAllSectionEvents</a></li><li><a href="global.html#fetchEventAttendance">fetchEventAttendance</a></li><li><a href="global.html#fetchMostRecentTermId">fetchMostRecentTermId</a></li><li><a href="global.html#fetchSectionEvents">fetchSectionEvents</a></li><li><a href="global.html#filterEventsByDateRange">filterEventsByDateRange</a></li><li><a href="global.html#formatPhoneForCall">formatPhoneForCall</a></li><li><a href="global.html#generateDemoSharedAttendance">generateDemoSharedAttendance</a></li><li><a href="global.html#generateVikingSectionMoversErrorMessages">generateVikingSectionMoversErrorMessages</a></li><li><a href="global.html#getEventAttendance">getEventAttendance</a></li><li><a href="global.html#getEventSharingStatus">getEventSharingStatus</a></li><li><a href="global.html#getEventSummary">getEventSummary</a></li><li><a href="global.html#getEvents">getEvents</a></li><li><a href="global.html#getFlexiRecords">getFlexiRecords</a></li><li><a href="global.html#getFlexiStructure">getFlexiStructure</a></li><li><a href="global.html#getListOfMembers">getListOfMembers</a></li><li><a href="global.html#getMembersGrid">getMembersGrid</a></li><li><a href="global.html#getMostRecentTermId">getMostRecentTermId</a></li><li><a href="global.html#getSharedEventAttendance">getSharedEventAttendance</a></li><li><a href="global.html#getSingleFlexiRecord">getSingleFlexiRecord</a></li><li><a href="global.html#getStartupData">getStartupData</a></li><li><a href="global.html#getTerms">getTerms</a></li><li><a href="global.html#getUserAccessibleSections">getUserAccessibleSections</a></li><li><a href="global.html#getUserRoles">getUserRoles</a></li><li><a href="global.html#groupContactInfo">groupContactInfo</a></li><li><a href="global.html#groupEventsByName">groupEventsByName</a></li><li><a href="global.html#handleAPIResponseWithRateLimit">handleAPIResponseWithRateLimit</a></li><li><a href="global.html#handlePhoneCall">handlePhoneCall</a></li><li><a href="global.html#initializeDemoMode">initializeDemoMode</a></li><li><a href="global.html#isDemoMode">isDemoMode</a></li><li><a href="global.html#isSharedEventOwner">isSharedEventOwner</a></li><li><a href="global.html#isValidPhoneNumber">isValidPhoneNumber</a></li><li><a href="global.html#logRateLimitInfo">logRateLimitInfo</a></li><li><a href="global.html#mergeSharedAndSectionAttendance">mergeSharedAndSectionAttendance</a></li><li><a href="global.html#multiUpdateFlexiRecord">multiUpdateFlexiRecord</a></li><li><a href="global.html#organizeByCampGroups">organizeByCampGroups</a></li><li><a href="global.html#parseTimestamp">parseTimestamp</a></li><li><a href="global.html#quickValidateVikingSectionMovers">quickValidateVikingSectionMovers</a></li><li><a href="global.html#retrieveUserInfo">retrieveUserInfo</a></li><li><a href="global.html#safeCacheWithLogging">safeCacheWithLogging</a></li><li><a href="global.html#safeGetItem">safeGetItem</a></li><li><a href="global.html#safeGetSessionItem">safeGetSessionItem</a></li><li><a href="global.html#safeSetItem">safeSetItem</a></li><li><a href="global.html#safeSetSessionItem">safeSetSessionItem</a></li><li><a href="global.html#sleep">sleep</a></li><li><a href="global.html#sleepWithAbort">sleepWithAbort</a></li><li><a href="global.html#testBackendConnection">testBackendConnection</a></li><li><a href="global.html#updateFlexiRecord">updateFlexiRecord</a></li><li><a href="global.html#useAttendanceData">useAttendanceData</a></li><li><a href="global.html#useSignInOut">useSignInOut</a></li><li><a href="global.html#validateMemberMove">validateMemberMove</a></li><li><a href="global.html#validateTokenBeforeAPICall">validateTokenBeforeAPICall</a></li><li><a href="global.html#validateVikingSectionMoversFlexiRecord">validateVikingSectionMoversFlexiRecord</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Fri Sep 12 2025 15:24:48 GMT+0100 (British Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
