<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Module: auth</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Module: auth</h1>

    




<section>

<header>
    
        
            
        
    
</header>

<article>
    <div class="container-overview">
    
        
            <div class="description"><p>Authentication service for Viking Event Management Mobile</p>
<p>Provides comprehensive authentication utilities with offline-first design,
token management, OAuth integration, and Scout-specific user handling.
Supports both production OSM authentication and demo mode for offline testing.</p>
<p>Features:</p>
<ul>
<li>OSM OAuth token management with expiration handling</li>
<li>Offline mode support with cached data preservation</li>
<li>Demo mode for testing without API connectivity</li>
<li>Sentry user context integration</li>
<li>Rate limiting awareness and blocked status handling</li>
</ul></div>
        

        
            















<dl class="details">

    
    <dt class="tag-version">Version:</dt>
    <dd class="tag-version"><ul class="dummy"><li>2.3.7</li></ul></dd>
    

    
    <dt class="tag-since">Since:</dt>
    <dd class="tag-since"><ul class="dummy"><li>2.3.7 - Simplified from heavy API imports to lightweight token management</li></ul></dd>
    

    

    

    

    

    

    

    
    <dt class="tag-author">Author:</dt>
    <dd class="tag-author">
        <ul>
            <li>Vikings Event Management Team</li>
        </ul>
    </dd>
    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="features_auth_services_auth.js.html">features/auth/services/auth.js</a>, <a href="features_auth_services_auth.js.html#line1">line 1</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
    
    </div>

    

    

    

    

    

    

    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    
    <h4 class="name" id=".clearToken"><span class="type-signature">(static) </span>clearToken<span class="signature">()</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Clears authentication token and resets session state</p>
<p>Removes the access token and all related authentication flags from session
storage. Resets auth handler state and clears Sentry user context. Used for
logout operations and token expiration handling. Does NOT clear offline cached data.</p>
</div>













<dl class="details">

    

    
    <dt class="tag-since">Since:</dt>
    <dd class="tag-since"><ul class="dummy"><li>2.3.7</li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="features_auth_services_auth.js.html">features/auth/services/auth.js</a>, <a href="features_auth_services_auth.js.html#line181">line 181</a>
    </li></ul></dd>
    

    

    

    
</dl>



















    <h5>Examples</h5>
    
    <pre class="prettyprint"><code>// User-initiated logout
const handleLogout = () => {
  clearToken();
  notifyInfo('You have been logged out');
  navigate('/login');
};</code></pre>

    <pre class="prettyprint"><code>// Automatic token expiration
const checkTokenExpiration = () => {
  if (isTokenExpired()) {
    clearToken();
    notifyWarning('Session expired. Switching to offline mode.');
  }
};</code></pre>

    <pre class="prettyprint"><code>// Error handling - clear invalid token
const handleAuthError = (error) => {
  if (error.status === 401) {
    clearToken();
    notifyError('Authentication failed', error);
  }
};</code></pre>



        
            

    

    
    <h4 class="name" id=".generateOAuthUrl"><span class="type-signature">(static) </span>generateOAuthUrl<span class="signature">(storeCurrentPath<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {string}</span></h4>
    

    



<div class="description">
    <p>Generates OAuth URL for OSM authentication</p>
<p>Creates a secure OAuth authentication URL that redirects to the backend
OAuth handler. Automatically detects environment (dev/prod) and embeds
frontend URL for proper callback handling. Optionally stores current path
for return after authentication.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>storeCurrentPath</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    false
                
                </td>
            

            <td class="description last"><p>Whether to store current path for post-auth redirect</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    
    <dt class="tag-since">Since:</dt>
    <dd class="tag-since"><ul class="dummy"><li>2.3.7</li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="features_auth_services_auth.js.html">features/auth/services/auth.js</a>, <a href="features_auth_services_auth.js.html#line446">line 446</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>Complete OAuth URL for redirect to authentication</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">string</span>


    </dd>
</dl>

    




    <h5>Examples</h5>
    
    <pre class="prettyprint"><code>// Basic login redirect
const handleLogin = () => {
  const authUrl = generateOAuthUrl(true); // Store current path
  window.location.href = authUrl;
};</code></pre>

    <pre class="prettyprint"><code>// Login button component
const LoginButton = () => (
  &lt;button 
    onClick={() => window.location.href = generateOAuthUrl(true)}
    className="bg-scout-blue text-white px-4 py-2 rounded"
  >
    Login with OSM
  &lt;/button>
);</code></pre>

    <pre class="prettyprint"><code>// Conditional authentication
const requireAuth = (callback) => {
  if (!isAuthenticated()) {
    const authUrl = generateOAuthUrl(true);
    notifyInfo('Authentication required');
    setTimeout(() => window.location.href = authUrl, 1500);
    return;
  }
  callback();
};</code></pre>

    <pre class="prettyprint"><code>// Environment-aware authentication
const getAuthUrl = () => {
  const url = generateOAuthUrl();
  console.log('Environment:', url.includes('prod') ? 'Production' : 'Development');
  return url;
};</code></pre>



        
            

    

    
    <h4 class="name" id=".getToken"><span class="type-signature">(static) </span>getToken<span class="signature">()</span><span class="type-signature"> &rarr; {string|null}</span></h4>
    

    



<div class="description">
    <p>Retrieves the current authentication token from session storage</p>
<p>Returns the OSM access token if valid, or a demo token in demo mode.
Checks for token expiration flags and returns null if token is expired.
This function is the primary interface for checking authentication status.</p>
</div>













<dl class="details">

    

    
    <dt class="tag-since">Since:</dt>
    <dd class="tag-since"><ul class="dummy"><li>2.3.7</li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="features_auth_services_auth.js.html">features/auth/services/auth.js</a>, <a href="features_auth_services_auth.js.html#line68">line 68</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>Access token if available and valid, null if expired or missing</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">string</span>
|

<span class="param-type">null</span>


    </dd>
</dl>

    




    <h5>Examples</h5>
    
    <pre class="prettyprint"><code>// Check if user has valid token
const token = getToken();
if (token) {
  // Make authenticated API calls
  const response = await api.getData(token);
} else {
  // Redirect to login
  window.location.href = generateOAuthUrl();
}</code></pre>

    <pre class="prettyprint"><code>// Demo mode usage
if (isDemoMode()) {
  const demoToken = getToken(); // Returns 'demo-mode-token'
  // Use demo token for offline functionality
}</code></pre>

    <pre class="prettyprint"><code>// Token expiration check
const checkAuth = () => {
  const token = getToken();
  if (!token &amp;&amp; sessionStorage.getItem('token_expired') === 'true') {
    notifyWarning('Session expired. Please log in again.');
    handleTokenExpiration();
  }
};</code></pre>



        
            

    

    
    <h4 class="name" id=".isAuthenticated"><span class="type-signature">(static) </span>isAuthenticated<span class="signature">()</span><span class="type-signature"> &rarr; {boolean}</span></h4>
    

    



<div class="description">
    <p>Checks if user is currently authenticated</p>
<p>Returns true if user has a valid authentication token and can access
protected features. In demo mode, always returns true to enable offline
functionality. Checks for invalid token flags without making API calls.</p>
</div>













<dl class="details">

    

    
    <dt class="tag-since">Since:</dt>
    <dd class="tag-since"><ul class="dummy"><li>2.3.7</li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="features_auth_services_auth.js.html">features/auth/services/auth.js</a>, <a href="features_auth_services_auth.js.html#line251">line 251</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>True if user is authenticated and can access protected features</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">boolean</span>


    </dd>
</dl>

    




    <h5>Examples</h5>
    
    <pre class="prettyprint"><code>// Route protection
const ProtectedRoute = ({ children }) => {
  if (!isAuthenticated()) {
    return &lt;Navigate to="/login" />;
  }
  return children;
};</code></pre>

    <pre class="prettyprint"><code>// Conditional UI rendering
const HeaderComponent = () => (
  &lt;header>
    {isAuthenticated() ? (
      &lt;UserMenu />
    ) : (
      &lt;LoginButton />
    )}
  &lt;/header>
);</code></pre>

    <pre class="prettyprint"><code>// Feature access check
const handleSaveEvent = () => {
  if (!isAuthenticated()) {
    notifyError('Please log in to save events');
    return;
  }
  // Proceed with save operation
};</code></pre>



        
            

    

    
    <h4 class="name" id=".isTokenValid"><span class="type-signature">(static) </span>isTokenValid<span class="signature">(responseData)</span><span class="type-signature"> &rarr; {boolean}</span></h4>
    

    



<div class="description">
    <p>Validates API response data to check if token is still valid</p>
<p>Examines API response data for authentication error indicators such as
invalid token, unauthorized access, or token expiration messages. Used
to detect when tokens become invalid during API operations.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>responseData</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last"><p>API response data to check for auth errors</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    
    <dt class="tag-since">Since:</dt>
    <dd class="tag-since"><ul class="dummy"><li>2.3.7</li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="features_auth_services_auth.js.html">features/auth/services/auth.js</a>, <a href="features_auth_services_auth.js.html#line310">line 310</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>True if token appears valid, false if auth errors detected</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">boolean</span>


    </dd>
</dl>

    




    <h5>Examples</h5>
    
    <pre class="prettyprint"><code>// API response validation
const handleApiResponse = (response) => {
  if (!isTokenValid(response)) {
    sessionStorage.setItem('token_invalid', 'true');
    notifyError('Session expired. Please log in again.');
    handleTokenExpiration();
    return;
  }
  // Process valid response
};</code></pre>

    <pre class="prettyprint"><code>// Fetch wrapper with token validation
const apiCall = async (endpoint) => {
  const response = await fetch(endpoint);
  const data = await response.json();
  
  if (!isTokenValid(data)) {
    throw new Error('Authentication failed');
  }
  
  return data;
};</code></pre>



        
            

    

    
    <h4 class="name" id=".setToken"><span class="type-signature">(static) </span>setToken<span class="signature">(token)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Stores an authentication token and initializes user session</p>
<p>Sets the OSM access token in session storage and performs initialization
tasks including resetting auth error state and setting Sentry user context.
This function should be called after successful OAuth authentication.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>token</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"><p>OSM access token from successful OAuth flow</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    
    <dt class="tag-since">Since:</dt>
    <dd class="tag-since"><ul class="dummy"><li>2.3.7</li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="features_auth_services_auth.js.html">features/auth/services/auth.js</a>, <a href="features_auth_services_auth.js.html#line124">line 124</a>
    </li></ul></dd>
    

    

    

    
</dl>



















    <h5>Examples</h5>
    
    <pre class="prettyprint"><code>// After OAuth callback with token
const urlParams = new URLSearchParams(window.location.search);
const token = urlParams.get('access_token');
if (token) {
  setToken(token);
  // User is now authenticated
  navigate('/dashboard');
}</code></pre>

    <pre class="prettyprint"><code>// Manual token setting for testing
if (process.env.NODE_ENV === 'development') {
  setToken('test-token-12345');
  notifySuccess('Development token set for testing');
}</code></pre>

    <pre class="prettyprint"><code>// Token refresh scenario
const refreshAuthToken = async () => {
  try {
    const newToken = await api.refreshToken();
    setToken(newToken);
    notifySuccess('Session refreshed successfully');
  } catch (error) {
    notifyError('Failed to refresh session', error);
    handleTokenExpiration();
  }
};</code></pre>



        
    

    

    
</article>

</section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-DatabaseService.html">DatabaseService</a></li><li><a href="module-EventCard.html">EventCard</a></li><li><a href="module-FlexiRecordService.html">FlexiRecordService</a></li><li><a href="module-auth.html">auth</a></li><li><a href="module-logger.html">logger</a></li><li><a href="module-notifications.html">notifications</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-logger-logger.html">logger</a></li></ul><h3>Classes</h3><ul><li><a href="APIQueue.html">APIQueue</a></li><li><a href="RateLimitQueue.html">RateLimitQueue</a></li><li><a href="module-DatabaseService-DatabaseService.html">DatabaseService</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Alert">Alert</a></li><li><a href="global.html#AuthButton">AuthButton</a></li><li><a href="global.html#CampGroupCard">CampGroupCard</a></li><li><a href="global.html#CampGroupsView">CampGroupsView</a></li><li><a href="global.html#ConfirmModal">ConfirmModal</a></li><li><a href="global.html#DEMO_CACHE_DATA">DEMO_CACHE_DATA</a></li><li><a href="global.html#GroupNamesEditModal">GroupNamesEditModal</a></li><li><a href="global.html#Modal">Modal</a></li><li><a href="global.html#REQUIRED_VIKING_SECTION_MOVERS_FIELDS">REQUIRED_VIKING_SECTION_MOVERS_FIELDS</a></li><li><a href="global.html#SectionFilter">SectionFilter</a></li><li><a href="global.html#_generateProductionFormatAttendance">_generateProductionFormatAttendance</a></li><li><a href="global.html#assignMemberToCampGroupDemo">assignMemberToCampGroupDemo</a></li><li><a href="global.html#batchAssignMembers">batchAssignMembers</a></li><li><a href="global.html#buildEventCard">buildEventCard</a></li><li><a href="global.html#calculateActualAge">calculateActualAge</a></li><li><a href="global.html#calculateAge">calculateAge</a></li><li><a href="global.html#checkForDemoData">checkForDemoData</a></li><li><a href="global.html#checkNetworkStatus">checkNetworkStatus</a></li><li><a href="global.html#cleanupDemoCache">cleanupDemoCache</a></li><li><a href="global.html#clearFlexiRecordCaches">clearFlexiRecordCaches</a></li><li><a href="global.html#cn">cn</a></li><li><a href="global.html#convertSharedEventToAttendanceFormat">convertSharedEventToAttendanceFormat</a></li><li><a href="global.html#demoConfig">demoConfig</a></li><li><a href="global.html#expandSharedEvents">expandSharedEvents</a></li><li><a href="global.html#extractFlexiRecordContext">extractFlexiRecordContext</a></li><li><a href="global.html#extractVikingEventFields">extractVikingEventFields</a></li><li><a href="global.html#fetchAllSectionEvents">fetchAllSectionEvents</a></li><li><a href="global.html#fetchEventAttendance">fetchEventAttendance</a></li><li><a href="global.html#fetchMostRecentTermId">fetchMostRecentTermId</a></li><li><a href="global.html#fetchSectionEvents">fetchSectionEvents</a></li><li><a href="global.html#filterEventsByDateRange">filterEventsByDateRange</a></li><li><a href="global.html#findMemberSectionName">findMemberSectionName</a></li><li><a href="global.html#findMemberSectionType">findMemberSectionType</a></li><li><a href="global.html#generateDemoSharedAttendance">generateDemoSharedAttendance</a></li><li><a href="global.html#generateVikingSectionMoversErrorMessages">generateVikingSectionMoversErrorMessages</a></li><li><a href="global.html#getEventAttendance">getEventAttendance</a></li><li><a href="global.html#getEventSharingStatus">getEventSharingStatus</a></li><li><a href="global.html#getEventSummary">getEventSummary</a></li><li><a href="global.html#getEvents">getEvents</a></li><li><a href="global.html#getFlexiRecords">getFlexiRecords</a></li><li><a href="global.html#getFlexiStructure">getFlexiStructure</a></li><li><a href="global.html#getListOfMembers">getListOfMembers</a></li><li><a href="global.html#getMembersGrid">getMembersGrid</a></li><li><a href="global.html#getMostRecentTermId">getMostRecentTermId</a></li><li><a href="global.html#getSharedEventAttendance">getSharedEventAttendance</a></li><li><a href="global.html#getSingleFlexiRecord">getSingleFlexiRecord</a></li><li><a href="global.html#getStartupData">getStartupData</a></li><li><a href="global.html#getTerms">getTerms</a></li><li><a href="global.html#getUniqueSectionsFromEvents">getUniqueSectionsFromEvents</a></li><li><a href="global.html#getUserAccessibleSections">getUserAccessibleSections</a></li><li><a href="global.html#getUserRoles">getUserRoles</a></li><li><a href="global.html#groupContactInfo">groupContactInfo</a></li><li><a href="global.html#groupEventsByName">groupEventsByName</a></li><li><a href="global.html#handleAPIResponseWithRateLimit">handleAPIResponseWithRateLimit</a></li><li><a href="global.html#initializeDemoMode">initializeDemoMode</a></li><li><a href="global.html#isDemoMode">isDemoMode</a></li><li><a href="global.html#isSharedEventOwner">isSharedEventOwner</a></li><li><a href="global.html#logRateLimitInfo">logRateLimitInfo</a></li><li><a href="global.html#mergeSharedAndSectionAttendance">mergeSharedAndSectionAttendance</a></li><li><a href="global.html#multiUpdateFlexiRecord">multiUpdateFlexiRecord</a></li><li><a href="global.html#organizeByCampGroups">organizeByCampGroups</a></li><li><a href="global.html#organizeMembersByCampGroups">organizeMembersByCampGroups</a></li><li><a href="global.html#parseFlexiStructure">parseFlexiStructure</a></li><li><a href="global.html#parseTimestamp">parseTimestamp</a></li><li><a href="global.html#quickValidateVikingSectionMovers">quickValidateVikingSectionMovers</a></li><li><a href="global.html#retrieveUserInfo">retrieveUserInfo</a></li><li><a href="global.html#safeCacheWithLogging">safeCacheWithLogging</a></li><li><a href="global.html#safeGetItem">safeGetItem</a></li><li><a href="global.html#safeGetSessionItem">safeGetSessionItem</a></li><li><a href="global.html#safeSetItem">safeSetItem</a></li><li><a href="global.html#safeSetSessionItem">safeSetSessionItem</a></li><li><a href="global.html#sleep">sleep</a></li><li><a href="global.html#sleepWithAbort">sleepWithAbort</a></li><li><a href="global.html#testBackendConnection">testBackendConnection</a></li><li><a href="global.html#transformFlexiRecordData">transformFlexiRecordData</a></li><li><a href="global.html#updateFlexiRecord">updateFlexiRecord</a></li><li><a href="global.html#useAttendanceData">useAttendanceData</a></li><li><a href="global.html#useSignInOut">useSignInOut</a></li><li><a href="global.html#validateMemberMove">validateMemberMove</a></li><li><a href="global.html#validateTokenBeforeAPICall">validateTokenBeforeAPICall</a></li><li><a href="global.html#validateVikingSectionMoversFlexiRecord">validateVikingSectionMoversFlexiRecord</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Wed Sep 10 2025 22:12:57 GMT+0100 (British Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>