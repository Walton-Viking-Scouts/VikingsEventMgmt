---
phase: 05-terms-normalization
plan: 03
type: execute
wave: 3
depends_on: ["05-02"]
files_modified:
  - src/pages/YoungLeadersPage.jsx
  - src/shared/services/auth.js
  - src/shared/services/demoMode.js
  - src/shared/services/storage/currentActiveTermsService.js
autonomous: true

must_haves:
  truths:
    - "YoungLeadersPage reads terms from DatabaseService instead of UnifiedStorageService blob"
    - "auth.js no longer references viking_terms_offline blob key"
    - "demoMode seeds terms to normalized store instead of blob"
    - "migrateFromTermsBlob is removed or made a no-op since blob format no longer exists"
  artifacts:
    - path: "src/pages/YoungLeadersPage.jsx"
      provides: "Terms read via DatabaseService.getTerms or getAllTerms"
      contains: "DatabaseService"
    - path: "src/shared/services/auth.js"
      provides: "Removed viking_terms_offline references"
    - path: "src/shared/services/storage/currentActiveTermsService.js"
      provides: "migrateFromTermsBlob removed or no-op"
  key_links:
    - from: "YoungLeadersPage.jsx"
      to: "DatabaseService.getTerms"
      via: "import and call"
      pattern: "getTerms|getAllTerms"
    - from: "demoMode.js"
      to: "DatabaseService.saveTerms"
      via: "seed normalized store"
      pattern: "saveTerms"
---

<objective>
Migrate all legacy blob consumers to use the normalized terms store. Remove obsolete blob references and migration code.

Purpose: Completes the terms normalization by ensuring no code still reads the old blob format. Per the NO BACKWARDS COMPATIBILITY policy, legacy code is removed rather than maintained.
Output: All terms consumers use DatabaseService. No viking_terms_offline references remain in modified files.
</objective>

<execution_context>
@/Users/simon/.claude/get-shit-done/workflows/execute-plan.md
@/Users/simon/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-terms-normalization/05-RESEARCH.md
@.planning/phases/05-terms-normalization/05-02-SUMMARY.md
@src/pages/YoungLeadersPage.jsx
@src/shared/services/auth.js
@src/shared/services/demoMode.js
@src/shared/services/storage/currentActiveTermsService.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate YoungLeadersPage and auth.js from blob to normalized store</name>
  <files>
    src/pages/YoungLeadersPage.jsx
    src/shared/services/auth.js
  </files>
  <action>
**YoungLeadersPage.jsx (lines ~120-138):** The page reads terms via `UnifiedStorageService.get('viking_terms_offline')` as a fallback. Replace this with a call to `DatabaseService.getInstance().getAllTerms()` or `DatabaseService.getInstance().getTerms(sectionId)` depending on how the data is consumed. The old blob returned all terms as an object keyed by sectionId -- the new method returns an array of individual term records. Adjust the consumer code to work with the array format (group by sectionid if needed). Import DatabaseService at the top of the file. Remove the UnifiedStorageService import if it becomes unused.

**auth.js (lines ~609-697):** This file references `viking_terms_offline` for cache checking and cleanup during logout/auth flows. Find all references to `viking_terms_offline` in this file:
- If it's part of a cache-check list (checking if offline data exists), either remove the terms entry from the list or replace with a check against the normalized store.
- If it's part of a cleanup/clear function (clearing data on logout), the old key can simply be removed from the list since the v7 IndexedDB upgrade already deleted the old store. No explicit cleanup of the normalized store is needed on logout (terms are not user-specific, they're org-wide).
- Remove any `localStorage.removeItem('viking_terms_offline')` or equivalent calls.

Do NOT modify any `current_active_terms` references in either file. Add JSDoc where functions are modified. Do NOT add inline comments.
  </action>
  <verify>
Grep YoungLeadersPage.jsx for `viking_terms_offline` and `UnifiedStorageService` -- must return zero matches (unless UnifiedStorageService is used for other keys). Grep auth.js for `viking_terms_offline` -- must return zero matches. Run `npm run lint` and `npm run test:run`.
  </verify>
  <done>YoungLeadersPage reads terms from DatabaseService. auth.js has no viking_terms_offline references. No UnifiedStorageService blob reads for terms remain in these files.</done>
</task>

<task type="auto">
  <name>Task 2: Update demoMode and remove migrateFromTermsBlob</name>
  <files>
    src/shared/services/demoMode.js
    src/shared/services/storage/currentActiveTermsService.js
  </files>
  <action>
**demoMode.js:** Find where demo terms are seeded. The old code likely writes a terms blob via UnifiedStorageService or localStorage. Replace with calls to `DatabaseService.getInstance().saveTerms(sectionId, termsArray)` for each section's demo terms. If demo terms are structured as `{ sectionId: [terms...] }`, iterate the entries and call saveTerms for each. Import DatabaseService if not already imported. Remove the old blob write. If demoMode does NOT write terms data (only current_active_terms), then no change is needed -- verify by searching for `viking_terms_offline` or `terms` in the file.

**currentActiveTermsService.js:** The `migrateFromTermsBlob()` method reads from `UnifiedStorageService.get('viking_terms_offline')` which mapped to the old blob-format terms store. After the v7 upgrade, the old store no longer exists and this method will always fail or return nothing. Per the NO BACKWARDS COMPATIBILITY policy, remove this method entirely. Also remove any calls to it from other files (search for `migrateFromTermsBlob` across the codebase). If the method is called during app initialization, remove that call too.

Add JSDoc where functions are modified. Do NOT add inline comments.
  </action>
  <verify>
Grep the entire src directory for `migrateFromTermsBlob` -- must return zero matches. Grep demoMode.js for `viking_terms_offline` -- must return zero matches. Run `npm run lint` and `npm run test:run`.
  </verify>
  <done>Demo mode seeds terms to normalized store. migrateFromTermsBlob is removed from currentActiveTermsService.js and all callers. No legacy blob references remain in modified consumer files.</done>
</task>

</tasks>

<verification>
1. `npm run lint` passes
2. `npm run test:run` passes
3. Grep entire src/ for `viking_terms_offline` -- should only appear in UnifiedStorageService key mapping (Phase 7 cleanup) or not at all
4. Grep entire src/ for `migrateFromTermsBlob` -- zero matches
5. YoungLeadersPage, auth.js, demoMode.js all use DatabaseService for terms
</verification>

<success_criteria>
All legacy blob consumers migrated to normalized terms store. No code reads the old viking_terms_offline blob. migrateFromTermsBlob removed. The terms normalization is complete end-to-end.
</success_criteria>

<output>
After completion, create `.planning/phases/05-terms-normalization/05-03-SUMMARY.md`
</output>
