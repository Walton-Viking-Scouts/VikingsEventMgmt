<!DOCTYPE html>
<html>
<head>
    <title>Check Production Cache Structure</title>
</head>
<body>
    <h1>Production Cache Structure Checker</h1>
    <p>Open this file in a browser where you have production Viking Event Mgmt data cached, then check the console.</p>
    
    <script>
        console.log('=== CHECKING PRODUCTION CACHE STRUCTURE ===');
        
        // Check sections
        const sections = localStorage.getItem('viking_sections_offline');
        if (sections) {
            const parsed = JSON.parse(sections);
            console.log('SECTIONS Structure:', parsed);
            console.log('- Is Array?', Array.isArray(parsed));
            console.log('- Has items property?', parsed.items !== undefined);
            console.log('- Sample section:', Array.isArray(parsed) ? parsed[0] : parsed.items?.[0]);
        }
        
        // Check events for each section (try common section IDs)
        const sectionIds = [11107, 63813, 11113, 49097];
        sectionIds.forEach(sectionId => {
            // Try without termId
            const keyWithoutTerm = `viking_events_${sectionId}_offline`;
            const eventsWithoutTerm = localStorage.getItem(keyWithoutTerm);
            if (eventsWithoutTerm) {
                const parsed = JSON.parse(eventsWithoutTerm);
                console.log(`EVENTS for section ${sectionId} (no term):`, parsed);
                console.log('- Is Array?', Array.isArray(parsed));
                console.log('- Has items property?', parsed.items !== undefined);
                console.log('- Sample event:', Array.isArray(parsed) ? parsed[0] : parsed.items?.[0]);
            }
            
            // Try with termId
            const termIds = ['term_autumn_2025', 'term_winter_2024', 'term_spring_2025'];
            termIds.forEach(termId => {
                const keyWithTerm = `viking_events_${sectionId}_${termId}_offline`;
                const eventsWithTerm = localStorage.getItem(keyWithTerm);
                if (eventsWithTerm) {
                    const parsed = JSON.parse(eventsWithTerm);
                    console.log(`EVENTS for section ${sectionId} with term ${termId}:`, parsed);
                    console.log('- Is Array?', Array.isArray(parsed));
                    console.log('- Has items property?', parsed.items !== undefined);
                    console.log('- Sample event:', Array.isArray(parsed) ? parsed[0] : parsed.items?.[0]);
                }
            });
        });
        
        // Check attendance structure
        console.log('\n=== ATTENDANCE CACHE KEYS ===');
        const allKeys = Object.keys(localStorage);
        const attendanceKeys = allKeys.filter(k => k.includes('viking_attendance_'));
        attendanceKeys.forEach(key => {
            const data = localStorage.getItem(key);
            const parsed = JSON.parse(data);
            console.log(`${key}:`, {
                isArray: Array.isArray(parsed),
                hasItems: parsed.items !== undefined,
                sampleSize: Array.isArray(parsed) ? parsed.length : parsed.items?.length,
                sample: Array.isArray(parsed) ? parsed[0] : parsed.items?.[0]
            });
        });
        
        // Check shared metadata
        console.log('\n=== SHARED METADATA KEYS ===');
        const metadataKeys = allKeys.filter(k => k.includes('viking_shared_metadata_'));
        metadataKeys.forEach(key => {
            const data = localStorage.getItem(key);
            const parsed = JSON.parse(data);
            console.log(`${key}:`, parsed);
        });
        
        // List all viking_ keys
        console.log('\n=== ALL VIKING CACHE KEYS ===');
        const vikingKeys = allKeys.filter(k => k.startsWith('viking_')).sort();
        vikingKeys.forEach(key => {
            console.log(key);
        });
    </script>
</body>
</html>